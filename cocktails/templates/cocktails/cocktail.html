{% extends 'cocktails/base.html' %}
{% load widget_tweaks %}
{% block title %}{{ cocktail.name }}{% endblock %}

{% block content %}
<div style="padding:20px;">
    <a href="{% url 'index' %}" style="color:#ffd700;">&#8592; На главную</a>
    <h2 style="margin-top:10px;">{{ cocktail.name }}</h2>

    <div style="display:flex; flex-wrap:wrap; gap:20px;">
        <div style="flex:1; min-width:250px; background:#1e1e1e; padding:20px; border-radius:10px;">
            <ul>
                <li>Вкус: {{ cocktail.taste }}</li>
                <li>Тип: {{ cocktail.group }}</li>
                <li>Крепость: {{ cocktail.alcohol }} ({{cocktail.alcohol_perc}}°)</li>
                <li class="cost">Стоимость: <b class="cost">{{ cocktail.cost }}</b></li>
                <li>Состав:
                    <ul>
                        {% for i in ingr_list %}
                            <li>{{ i.ingridient_id}}: {{ i.value }}</li>
                        {% endfor %}
                    </ul>
                </li>
                <li>Приготовление: {{ cocktail.method }}</li>
            </ul>

            <form action="{% url 'order' cocktail.pk %}" method="post">
                {% csrf_token %}
                Клиент: {{ form.client }}
                <button class="openbtn" id="openModal" type="submit">Заказать</button>
            </form>
        </div>

        <div style="flex:1; min-width:250px;">
            <img src="{{ cocktail.img.url }}" alt="{{ cocktail.name }}" style="width:100%; border-radius:10px;"/>
        </div>
    </div>

    {% if cocktail.comment %}
    <p style="margin-top:20px; font-style:italic;">{{ cocktail.comment }}</p>
    {% endif %}
</div>

<!-- Modal -->
<div class="modal" id="myModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6);">
    <div style="background:#fff; padding:20px; border-radius:10px; max-width:400px; margin:10% auto; position:relative;">
        <span style="position:absolute; right:10px; top:10px; cursor:pointer;" id="closeModal">&times;</span>
        <h3>Заказ оформлен</h3>
        <p>Проверьте его наличие в окне "Заказы"</p>
    </div>
</div>

<script>
const modal = document.getElementById('myModal');
const btn = document.getElementById('openModal');
const closeBtn = document.getElementById('closeModal');

btn.addEventListener('click', function(e){
    e.preventDefault();
    modal.style.display = 'block';
    btn.form.submit();
});
closeBtn.addEventListener('click', ()=> modal.style.display='none');
window.addEventListener('click', e=> { if(e.target===modal) modal.style.display='none'; });
</script>

<!-- Sidepanel for orders -->
<div id="mySidepanel" class="sidepanel">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    <h2 style="padding-left:20px;">Заказы</h2>
    <div id="items" style="padding-left:20px;">
        {% for bill in bills %}
            <p>{{ bill.cock_name }} {{ bill.timestamp }} {{ bill.client }} {{ bill.cost }} Руб</p>
        {% endfor %}
    </div>
</div>

<button class="openbtn" onclick="openNav()" style="position:fixed; bottom:20px; left:20px;">&#9776; Заказы</button>
{% endblock %}
